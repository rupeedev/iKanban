# ===========================================
# MCP Server Runtime Docker Image
# Based on same runtime pattern as Dockerfile.runtime
# Expects pre-built binary to be copied in
# ===========================================
FROM ubuntu:24.04

RUN apt-get update && apt-get install -y \
    ca-certificates \
    tini \
    libssl3 \
    && rm -rf /var/lib/apt/lists/*

# Create app user
RUN groupadd -g 1001 appgroup && \
    useradd -u 1001 -g appgroup -m -s /bin/bash appuser

# Copy binary from CI build artifacts
COPY mcp_task_server /usr/local/bin/mcp_task_server
RUN chmod +x /usr/local/bin/mcp_task_server

USER appuser

# Environment variables for Railway deployment
ENV MCP_TRANSPORT=sse
ENV HOST=0.0.0.0
# PORT is set by Railway automatically

EXPOSE 3001

ENTRYPOINT ["/usr/bin/tini", "--"]
CMD ["/usr/local/bin/mcp_task_server"]
