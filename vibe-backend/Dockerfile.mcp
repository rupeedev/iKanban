# ===========================================
# MCP Server Runtime Dockerfile
# Expects pre-compiled binary "mcp_task_server" in current dir
# ===========================================
FROM ubuntu:24.04

# Install runtime dependencies
RUN apt-get update && apt-get install -y \
    ca-certificates \
    tini \
    libssl3 \
    && rm -rf /var/lib/apt/lists/*

# Create app user
RUN groupadd -g 1001 appgroup && \
    useradd -u 1001 -g appgroup -m -s /bin/bash appuser

# Copy pre-built binary
COPY mcp_task_server /usr/local/bin/mcp_task_server
RUN chmod +x /usr/local/bin/mcp_task_server

USER appuser

# Environment variables for Railway deployment
ENV MCP_TRANSPORT=sse
ENV HOST=0.0.0.0
# PORT is set by Railway automatically

EXPOSE 3001

ENTRYPOINT ["/usr/bin/tini", "--"]
CMD ["/usr/local/bin/mcp_task_server"]
