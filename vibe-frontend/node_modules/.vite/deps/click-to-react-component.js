import {
  FloatingFocusManager,
  FloatingOverlay,
  FloatingPortal,
  arrow,
  autoUpdate,
  flip,
  o,
  offset,
  shift,
  useDismiss,
  useFloating,
  useInteractions,
  useListNavigation,
  useRole
} from "./chunk-N4QLBDTK.js";
import "./chunk-S3SA3LF6.js";
import "./chunk-NFC5BX5N.js";
import {
  require_react
} from "./chunk-CMM6OKGN.js";
import {
  __toESM
} from "./chunk-OL46QLBJ.js";

// node_modules/click-to-react-component/src/ClickToComponent.js
var React2 = __toESM(require_react(), 1);

// node_modules/click-to-react-component/src/ContextMenu.js
var React = __toESM(require_react(), 1);

// node_modules/react-merge-refs/dist/react-merge-refs.esm.js
function mergeRefs(refs) {
  return function(value) {
    refs.forEach(function(ref) {
      if (typeof ref === "function") {
        ref(value);
      } else if (ref != null) {
        ref.current = value;
      }
    });
  };
}
var react_merge_refs_esm_default = mergeRefs;

// node_modules/click-to-react-component/src/getDisplayNameFromReactInstance.js
function getDisplayNameForInstance(instance) {
  var _a, _b;
  const { elementType, tag } = instance;
  switch (tag) {
    case 0:
    case 1:
      return elementType.displayName || elementType.name || "Anonymous Component";
    case 3:
      return "HostRoot";
    case 4:
      return "HostPortal";
    case 5:
      return elementType;
    case 6:
      return "String";
    case 7:
      return "React.Fragment";
    case 8:
      return "Mode";
    case 9:
      return "Context.Consumer";
    case 10:
      return "Context.Provider";
    case 11:
      return "React.forwardRef";
    case 12:
      return "Profiler";
    case 13:
      return "SuspenseComponent";
    case 14:
    case 15:
      return ((_a = elementType.type) == null ? void 0 : _a.name) ?? ((_b = Symbol.keyFor) == null ? void 0 : _b.call(Symbol, elementType.$$typeof)) ?? "React.memo";
    case 16:
      return "React.lazy";
    case 17:
      return "IncompleteClassComponent";
    case 18:
      return "DehydratedFragment";
    case 19:
      return "SuspenseListComponent";
    case 21:
      return "ScopeComponent";
    case 22:
      return "OffscreenComponent";
    case 23:
      return "LegacyHiddenComponent";
    case 24:
      return "CacheComponent";
    case 25:
      return "TracingMarkerComponent";
    case 26:
      return "HostHoistable";
    case 27:
      return "HostSingleton";
    case 28:
      return "IncompleteFunctionComponent";
    case 29:
      return "Throw";
    default:
      console.warn(`Unrecognized React Fiber tag: ${tag}`, instance);
      return "Unknown Component";
  }
}

// node_modules/click-to-react-component/src/getPathToSource.js
function getPathToSource(source, pathModifier) {
  const {
    // It _does_ exist!
    // @ts-ignore Property 'columnNumber' does not exist on type 'Source'.ts(2339)
    columnNumber = 1,
    fileName,
    lineNumber = 1
  } = source;
  let path = `${fileName}:${lineNumber}:${columnNumber}`;
  if (pathModifier) {
    path = pathModifier(path);
  }
  return path;
}

// node_modules/click-to-react-component/src/getPropsForInstance.js
function getPropsForInstance(instance) {
  const props = {};
  Object.entries(instance.memoizedProps).forEach(([key, value]) => {
    var _a;
    const type = typeof value;
    if (["key"].includes(key) || value === ((_a = instance.type.defaultProps) == null ? void 0 : _a[key])) {
      return;
    }
    if (["string", "number", "boolean", "symbol"].includes(type) || value instanceof String || value instanceof Number || value instanceof Boolean || value instanceof Symbol) {
      props[key] = value;
    }
  });
  return props;
}

// node_modules/click-to-react-component/src/getReactInstanceForElement.js
function getReactInstanceForElement(element) {
  if ("__REACT_DEVTOOLS_GLOBAL_HOOK__" in window) {
    const { renderers } = window.__REACT_DEVTOOLS_GLOBAL_HOOK__;
    for (const renderer of renderers.values()) {
      try {
        const fiber = renderer.findFiberByHostInstance(element);
        if (fiber) {
          return fiber;
        }
      } catch (e) {
      }
    }
  }
  if ("_reactRootContainer" in element) {
    return element._reactRootContainer._internalRoot.current.child;
  }
  for (const key in element) {
    if (key.startsWith("__reactInternalInstance$")) {
      return element[key];
    }
    if (key.startsWith("__reactFiber")) {
      return element[key];
    }
  }
}

// node_modules/click-to-react-component/src/getReactInstancesForElement.js
function getReactInstancesForElement(element) {
  const instances = /* @__PURE__ */ new Set();
  let instance = getReactInstanceForElement(element);
  while (instance) {
    instances.add(instance);
    instance = instance._debugOwner;
  }
  return Array.from(instances);
}

// node_modules/click-to-react-component/src/getSourceForInstance.js
function getSourceForInstance(instance) {
  if (!instance._debugSource) {
    return;
  }
  const {
    // It _does_ exist!
    // @ts-ignore Property 'columnNumber' does not exist on type 'Source'.ts(2339)
    columnNumber = 1,
    fileName,
    lineNumber = 1
  } = instance._debugSource;
  return { columnNumber, fileName, lineNumber };
}

// node_modules/click-to-react-component/src/ContextMenu.js
var ContextMenu = React.forwardRef((props, ref) => {
  const { onClose, pathModifier } = props;
  const [target, setTarget] = React.useState(
    /** @type {HTMLElement | null} */
    null
  );
  const arrowRef = React.useRef(
    /** @type {HTMLElement | null} */
    null
  );
  const [activeIndex, setActiveIndex] = React.useState(
    /** @type {number | null} */
    null
  );
  const [open, setOpen] = React.useState(false);
  const listItemsRef = React.useRef(
    /** @type {Array<HTMLButtonElement | null>} */
    []
  );
  const {
    x,
    y,
    reference,
    floating,
    strategy,
    refs,
    update,
    context,
    placement,
    middlewareData: { arrow: { x: arrowX, y: arrowY } = {} }
  } = useFloating({
    open,
    onOpenChange(open2) {
      setOpen(open2);
      if (!open2) onClose == null ? void 0 : onClose();
    },
    middleware: [
      offset({ mainAxis: 5, alignmentAxis: 4 }),
      flip(),
      shift(),
      arrow({ element: arrowRef })
    ],
    placement: "right"
  });
  const { getFloatingProps, getItemProps } = useInteractions([
    useRole(context, { role: "menu" }),
    useDismiss(context),
    useListNavigation(context, {
      listRef: listItemsRef,
      activeIndex,
      onNavigate: setActiveIndex,
      focusItemOnOpen: false
    })
  ]);
  React.useEffect(() => {
    if (open && refs.reference.current && refs.floating.current) {
      return autoUpdate(refs.reference.current, refs.floating.current, update);
    }
  }, [open, update, refs.reference, refs.floating]);
  const mergedReferenceRef = React.useMemo(
    () => react_merge_refs_esm_default([ref, reference]),
    [reference, ref]
  );
  React.useEffect(() => {
    function onContextMenu(e) {
      if (!e.altKey) {
        return;
      }
      e.preventDefault();
      mergedReferenceRef({
        getBoundingClientRect() {
          return {
            x: e.clientX,
            y: e.clientY,
            width: 0,
            height: 0,
            top: e.clientY,
            right: e.clientX,
            bottom: e.clientY,
            left: e.clientX
          };
        }
      });
      setOpen(true);
      if (e.target instanceof HTMLElement) setTarget(e.target);
    }
    document.addEventListener("contextmenu", onContextMenu);
    return () => {
      document.removeEventListener("contextmenu", onContextMenu);
    };
  }, [mergedReferenceRef]);
  React.useLayoutEffect(() => {
    var _a;
    if (open) {
      (_a = refs.floating.current) == null ? void 0 : _a.focus();
    }
  }, [open, refs.floating]);
  React.useLayoutEffect(() => {
    if (!arrowRef.current) return;
    const staticSide = {
      top: "bottom",
      right: "left",
      bottom: "top",
      left: "right"
    }[placement.split("-")[0]];
    Object.assign(arrowRef.current.style, {
      display: "block",
      left: arrowX != null ? `${arrowX}px` : "",
      top: arrowY != null ? `${arrowY}px` : "",
      right: "",
      bottom: "",
      [staticSide]: "-4px"
    });
  }, [arrowX, arrowY, placement]);
  if (!target) {
    return null;
  }
  const instances = getReactInstancesForElement(target).filter(
    (instance) => getSourceForInstance(instance)
  );
  return o`
    <style key="click-to-component-contextmenu-style">
      #floating-ui-root > div {
        z-index: 2147483647;
      }

      [data-click-to-component-contextmenu],
      [data-click-to-component-contextmenu] * {
        box-sizing: border-box !important;
      }

      [data-click-to-component-contextmenu] {
        all: unset;
        outline: 0;
        background: white;
        color: black;
        font-weight: bold;
        overflow: visible;
        padding: 5px;
        font-size: 13px;
        border-radius: 6px;
        border: none;

        --shadow-color: 0deg 0% 0%;
        --shadow-elevation-low: 0px -1px 0.8px hsl(var(--shadow-color) / 0.1),
          0px -1.2px 0.9px -2.5px hsl(var(--shadow-color) / 0.07),
          0px -3px 2.3px -5px hsl(var(--shadow-color) / 0.03);

        --shadow-elevation-medium: 0px 1px 0.8px hsl(var(--shadow-color) / 0.11),
          0px 1.5px 1.1px -1.7px hsl(var(--shadow-color) / 0.08),
          0px 5.1px 3.8px -3.3px hsl(var(--shadow-color) / 0.05),
          0px 15px 11.3px -5px hsl(var(--shadow-color) / 0.03);
        --shadow-elevation-high: 0px 1px 0.8px hsl(var(--shadow-color) / 0.1),
          0px 1.1px 0.8px -0.7px hsl(var(--shadow-color) / 0.09),
          0px 2.1px 1.6px -1.4px hsl(var(--shadow-color) / 0.07),
          0px 4.9px 3.7px -2.1px hsl(var(--shadow-color) / 0.06),
          0px 10.1px 7.6px -2.9px hsl(var(--shadow-color) / 0.05),
          0px 18.9px 14.2px -3.6px hsl(var(--shadow-color) / 0.04),
          0px 31.9px 23.9px -4.3px hsl(var(--shadow-color) / 0.02),
          0px 50px 37.5px -5px hsl(var(--shadow-color) / 0.01);

        box-shadow: var(--shadow-elevation-high);
        filter: drop-shadow(0px 0px 0.5px rgba(0 0 0 / 50%));
      }

      [data-click-to-component-contextmenu] button {
        all: unset;
        outline: 0;
        display: flex;
        flex-direction: column;
        width: 100%;
        padding: 5px;
        border-radius: 4px;
        font-size: 13px;
        max-width: 50vw;
      }

      [data-click-to-component-contextmenu] button:focus,
      [data-click-to-component-contextmenu] button:not([disabled]):active {
        cursor: pointer;
        background: royalblue;
        color: white;
        box-shadow: var(--shadow-elevation-medium);
      }

      [data-click-to-component-contextmenu] button:focus code,
      [data-click-to-component-contextmenu] button:not([disabled]):active code {
        color: white;
      }

      [data-click-to-component-contextmenu] button > * + * {
        margin-top: 3px;
      }

      [data-click-to-component-contextmenu] button code {
        color: royalblue;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          'Liberation Mono', 'Courier New', monospace;
      }

      [data-click-to-component-contextmenu] button code var {
        background: rgba(0 0 0 / 5%);
        cursor: help;
        border-radius: 3px;
        padding: 3px 6px;
        font-style: normal;
        font-weight: normal;
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
          'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif,
          'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
          'Noto Color Emoji';
      }

      [data-click-to-component-contextmenu] button cite {
        font-weight: normal;
        font-style: normal;
        font-size: 11px;
        opacity: 0.5;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          'Liberation Mono', 'Courier New', monospace;
      }

      [data-click-to-component-contextmenu] button cite data::after {
        content: attr(value);
        float: right;
        padding-left: 15px;
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
          'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif,
          'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
          'Noto Color Emoji';
      }

      [data-click-to-component-contextmenu-arrow] {
        display: none;
        position: absolute;
        background: inherit;
        width: 8px;
        height: 8px;
        transform: rotate(45deg);
      }
    </style>

    ${open && o`
        <${FloatingOverlay} key="click-to-component-overlay" lockScroll>
          <${FloatingFocusManager} context=${context}>
            <dialog
              ...${getFloatingProps({
    ref: floating,
    style: {
      position: strategy,
      top: y ?? "",
      left: x ?? ""
    }
  })}
              data-click-to-component-contextmenu
              onClose=${function handleClose(event) {
    onClose(refs.floating.current.returnValue);
    setOpen(false);
  }}
              open
            >
              <form method="dialog">
                ${instances.map((instance, i) => {
    const name = getDisplayNameForInstance(instance);
    const source = getSourceForInstance(instance);
    const path = getPathToSource(source, pathModifier);
    const props2 = getPropsForInstance(instance);
    return o`
                    <button
                      ...${getItemProps({
      role: "menuitem",
      ref(node) {
        listItemsRef.current[i] = node;
      }
    })}
                      key=${i}
                      name="path"
                      type="submit"
                      value=${path}
                    >
                      <code>
                        ${"<"}${name}
                        ${Object.entries(props2).map(
      ([prop, value]) => o`
                            ${" "}
                            <var key=${prop} title="${value}">${prop}</var>
                          `
    )}
                        ${">"}
                      </code>
                      <cite>
                        <data
                          value="${source.lineNumber}:${source.columnNumber}"
                        >
                          ${source.fileName.replace(/.*(src|pages)/, "$1")}
                        </data>
                      </cite>
                    </button>
                  `;
  })}
              </form>

              <div
                data-click-to-component-contextmenu-arrow
                ref=${arrowRef}
              />
            </dialog>
          </${FloatingFocusManager}>
        </${FloatingOverlay}>
      `}
  `;
});

// node_modules/click-to-react-component/src/getUrl.js
function getUrl({ editor, pathToSource }) {
  if (pathToSource[0] === "/") {
    return `${editor}://file${pathToSource}`;
  }
  return `${editor}://file/${pathToSource}`;
}

// node_modules/click-to-react-component/src/ClickToComponent.js
var State = (
  /** @type {const} */
  {
    IDLE: "IDLE",
    HOVER: "HOVER",
    SELECT: "SELECT"
  }
);
function ClickToComponent({ editor = "vscode", pathModifier }) {
  const [state, setState] = React2.useState(
    /** @type {State[keyof State]} */
    State.IDLE
  );
  const [target, setTarget] = React2.useState(
    /** @type {HTMLElement | null} */
    null
  );
  const onClick = React2.useCallback(
    function handleClick(event) {
      if (state === State.HOVER && target instanceof HTMLElement) {
        const instance = getReactInstancesForElement(target).find(
          (instance2) => getSourceForInstance(instance2)
        );
        if (!instance) {
          return console.warn(
            "Could not find React instance for element",
            target
          );
        }
        const source = getSourceForInstance(instance);
        if (!source) {
          return console.warn(
            "Could not find source for React instance",
            instance
          );
        }
        const path = getPathToSource(source, pathModifier);
        const url = getUrl({
          editor,
          pathToSource: path
        });
        event.preventDefault();
        window.location.assign(url);
        setState(State.IDLE);
      }
    },
    [editor, pathModifier, state, target]
  );
  const onClose = React2.useCallback(
    function handleClose(returnValue) {
      if (returnValue) {
        const url = getUrl({
          editor,
          pathToSource: returnValue
        });
        window.location.assign(url);
      }
      setState(State.IDLE);
    },
    [editor]
  );
  const onContextMenu = React2.useCallback(
    function handleContextMenu(event) {
      const { target: target2 } = event;
      if (state === State.HOVER && target2 instanceof HTMLElement) {
        event.preventDefault();
        setState(State.SELECT);
        setTarget(target2);
      }
    },
    [state]
  );
  const onKeyDown = React2.useCallback(
    function handleKeyDown(event) {
      switch (state) {
        case State.IDLE:
          if (event.altKey) setState(State.HOVER);
          break;
        default:
      }
    },
    [state]
  );
  const onKeyUp = React2.useCallback(
    function handleKeyUp(event) {
      switch (state) {
        case State.HOVER:
          setState(State.IDLE);
          break;
        default:
      }
    },
    [state]
  );
  const onMouseMove = React2.useCallback(
    function handleMouseMove(event) {
      if (!(event.target instanceof HTMLElement)) {
        return;
      }
      switch (state) {
        case State.IDLE:
        case State.HOVER:
          setTarget(event.target);
          break;
        default:
          break;
      }
    },
    [state]
  );
  const onBlur = React2.useCallback(
    function handleBlur() {
      switch (state) {
        case State.HOVER:
          setState(State.IDLE);
          break;
        default:
      }
    },
    [state]
  );
  React2.useEffect(
    function toggleIndicator() {
      for (const element of Array.from(
        document.querySelectorAll("[data-click-to-component-target]")
      )) {
        if (element instanceof HTMLElement) {
          delete element.dataset.clickToComponentTarget;
        }
      }
      if (state === State.IDLE) {
        delete window.document.body.dataset.clickToComponent;
        if (target) {
          delete target.dataset.clickToComponentTarget;
        }
        return;
      }
      if (target instanceof HTMLElement) {
        window.document.body.dataset.clickToComponent = state;
        target.dataset.clickToComponentTarget = state;
      }
    },
    [state, target]
  );
  React2.useEffect(
    function addEventListenersToWindow() {
      window.addEventListener("click", onClick, { capture: true });
      window.addEventListener("contextmenu", onContextMenu, { capture: true });
      window.addEventListener("keydown", onKeyDown);
      window.addEventListener("keyup", onKeyUp);
      window.addEventListener("mousemove", onMouseMove);
      window.addEventListener("blur", onBlur);
      return function removeEventListenersFromWindow() {
        window.removeEventListener("click", onClick, { capture: true });
        window.removeEventListener("contextmenu", onContextMenu, {
          capture: true
        });
        window.removeEventListener("keydown", onKeyDown);
        window.removeEventListener("keyup", onKeyUp);
        window.removeEventListener("mousemove", onMouseMove);
        window.removeEventListener("blur", onBlur);
      };
    },
    [onClick, onContextMenu, onKeyDown, onKeyUp, onMouseMove, onBlur]
  );
  return o`
    <style key="click-to-component-style">
      [data-click-to-component] * {
        pointer-events: auto !important;
      }

      [data-click-to-component-target] {
        cursor: var(--click-to-component-cursor, context-menu) !important;
        outline: auto 1px;
        outline: var(
          --click-to-component-outline,
          -webkit-focus-ring-color auto 1px
        ) !important;
      }
    </style>

    <${FloatingPortal} key="click-to-component-portal">
      ${o`<${ContextMenu}
        key="click-to-component-contextmenu"
        onClose=${onClose}
        pathModifier=${pathModifier}
      />`}
    </${FloatingPortal}
  `;
}

// node_modules/click-to-react-component/src/index.js
var ClickToComponent2 = true ? ClickToComponent : () => null;
export {
  ClickToComponent2 as ClickToComponent
};
//# sourceMappingURL=click-to-react-component.js.map
